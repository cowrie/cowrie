# ABOUTME: Triggers LinkedIn release announcement in a separate private repository
# ABOUTME: Dispatches release event to cowrie-social repo for LinkedIn posting
---
name: Notify LinkedIn Release

on:  # yamllint disable-line rule:truthy
  release:
    types: [published]

jobs:
  notify-social:
    runs-on: ubuntu-latest
    # Only run on the main repository, not forks
    if: github.repository == 'cowrie/cowrie'

    steps:
      - name: Trigger LinkedIn post workflow
        env:
          GH_TOKEN: ${{ secrets.SOCIAL_REPO_TOKEN }}
        run: |
          if [ -z "${GH_TOKEN}" ]; then
            echo "::warning::SOCIAL_REPO_TOKEN secret is not set - skipping LinkedIn notification"
            exit 0
          fi

          # Send repository_dispatch event to the private social media repo
          curl -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${GH_TOKEN}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/cowrie/cowrie-social/dispatches \
            -d '{
              "event_type": "cowrie-release",
              "client_payload": {
                "tag": "${{ github.event.release.tag_name }}",
                "name": "${{ github.event.release.name }}",
                "url": "${{ github.event.release.html_url }}",
                "prerelease": ${{ github.event.release.prerelease }}
              }
            }'

          echo "âœ… Dispatched release event to cowrie-social repository"
